{% extends "base.html" %}

{% block alert %}
    {% if alerts %}
        <br>
        <div class="alert alert-position alert-dismissible fade show
                                        {% if alert_code == 1 %}
                                            alert-warning
                                        {% elif alert_code == 0 %}
                                            alert-danger
                                        {% endif %}
                                   " role="alert">
            {{ alerts|safe }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    {% endif %}
{% endblock %}

{% block body %}
    <div class="container">
        <div class="jumbotron mt-3">
            <div class="row">

                <div class="col-md-5">
                    Фільтрувати по даті від:
                    <div class="form-group">
                        <div class="input-group date" id="datetimepicker_from" data-target-input="nearest">
                            <input type="text" class="form-control datetimepicker-input"
                                   data-target="#datetimepicker_from"/>
                            <div class="input-group-append" data-target="#datetimepicker_from"
                                 data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-5">
                    До:
                    <div class="form-group">
                        <div class="input-group date" id="datetimepicker_to" data-target-input="nearest">
                            <input type="text" class="form-control datetimepicker-input"
                                   data-target="#datetimepicker_to"/>
                            <div class="input-group-append" data-target="#datetimepicker_to"
                                 data-toggle="datetimepicker">
                                <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <br>
                  <div class="custom-control custom-checkbox mb-3">
                    <input type="checkbox" class="custom-control-input" id="filter_by_date_checkbox" checked>
                    <label class="custom-control-label" for="filter_by_date_checkbox">Вибірка по даті</label>
                  </div>
                </div>

                <div class="col-md-4">
                    <form>
                        Стан термостату: <span id="ts_state_text"><b>Всі</b></span> <br>
                        <div class="btn-group btn-group-toggle" id="ts_state_group" data-toggle="buttons">
                          <label class="btn btn-secondary active">
                            <input type="radio" name="ts_group" value="2" id="all_ts_state" autocomplete="off" checked>Всі
                          </label>
                          <label class="btn btn-dark">
                            <input type="radio" name="ts_group" value="0" id="off_ts_state" autocomplete="off" >Вимк.
                          </label>
                          <label class="btn btn-success">
                            <input type="radio" name="ts_group" value="1" id="on_ts_state" autocomplete="off">Увімк.
                          </label>

                        </div>
                    </form>
                </div>

                <div class="col-md-4">
                    <form>
                        Темп. режим: <span id="current_state_text"><b>Всі</b></span>
                        <div class="btn-group btn-group-toggle" id="current_state_group" data-toggle="buttons">
                          <label class="btn btn-secondary active">
                            <input type="radio" name="current_ts_group" value="3" id="all_current_state" autocomplete="off" checked>Всі
                          </label>
                          <label class="btn btn-dark">
                            <input type="radio" name="current_ts_group" value="0" id="off_current_state" autocomplete="off" >Вимк.
                          </label>
                          <label class="btn btn-danger">
                            <input type="radio" name="current_ts_group" value="1" id="heat_current_state" autocomplete="off"> Нагрів
                          </label>
                          <label class="btn btn-primary">
                            <input type="radio" name="current_ts_group" value="2" id="cooling_current_state" autocomplete="off"> Охол.
                          </label>
                        </div>
                    </form>
                </div>

                <div class="col-md-4">
                    <form>
                         Світловий режим: <span id="light_state_text"><b>Всі</b></span>
                        <div class="btn-group btn-group-toggle" id="light_state_group" data-toggle="buttons">
                          <label class="btn btn-secondary active">
                            <input type="radio" name="light_group" value="4" id="all_light_state" autocomplete="off" checked>Всі
                          </label>
                          <label class="btn btn-dark">
                            <input type="radio" name="light_group" value="0" id="off_light_state" autocomplete="off" >Вимк.
                          </label>
                          <label class="btn btn-violet">
                            <input type="radio" name="light_group" value="1" id="uv_light_state" autocomplete="off"> UV
                          </label>
                          <label class="btn btn-light">
                            <input type="radio" name="light_group" value="2" id="rgb_light_state" autocomplete="off"> RGB
                          </label>
                          <label class="btn btn-warning">
                            <input type="radio" name="light_group" value="3" id="rgbuv_light_state" autocomplete="off"> RGB&UV
                          </label>
                        </div>
                    </form>
                </div>
                <div class="col-md-12">
                    <hr>
                </div>
                <div class="col-md-8">
{#                    <br>#}
                    <button id="get-all-data-button" class="btn btn-sm btn-success">Вибрати в даному діапазоні</button>

                    <button id="clean-all-data-button" class="btn btn-sm btn-warning">Очистити вибране</button>
                </div>

                <div class="col-md-4">
                    Кількість отриманих записів: <span class="badge badge-dark ">{{ all_records_number }}</span>
                </div>

            </div>
        </div>
        <div class="row">
            <div class="col-md-7">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th scope="col">id</th>
                            <th scope="col">Час | дата</th>
                            <th scope="col">Стан</th>
                            <th scope="col">Темп.</th>
                            <th scope="col">Освітлення</th>
                        </tr>
                        </thead>
                        <tbody>

                        {% for record in records %}
                            <tr data-value="{{ record.id }}">
                                <th scope="row">{{ record.id }}</th>
                                <td>{{ record.time|date:"H:i | d-m-Y" }}</td>
                                <td>
                                    {% if record.thermostat_state %}
                                        On
                                    {% else %}
                                        Off
                                    {% endif %}
                                </td>
                                <td>{{ record.temp }}</td>
                                <td>
                                    {{ record.get_light_mode }}
                                </td>
                            </tr>
                        {% endfor %}

                        </tbody>
                    </table>
                </div>

            </div>

            <div class="col-md-5 fix-block">
                <div id="detail-data" class="jumbotron mt-3 not-visible detail-data-block">
                    <li>id:
                        <span class="badge badge-light" id="th-id"></span>  /  datetime:
                        <span class="badge badge-light" id="th-date"></span>
                        <button type="button" id="close-data-block-button" style="float: right;" class="btn btn-sm btn-outline-dark">x</button>
                    </li>
                    <hr>
                    <li>Стан термостату:
                        <span class="badge" id="th-state"></span>
                    </li>

                    <li>Виконувана робота:
                        <span class="badge" id="th-work"></span>
                    </li>
                    <hr>
                    <li>Температура:
                        <span class="badge badge-info" id="th-temp"></span>
                    </li>
                    <li>Встановлена температура:
                        <span class="badge badge-info" id="th-set-t"></span>
                    </li>
                    <hr>
                    <li>Освітленість:
                        <span class="badge" id="th-light"></span>
                    </li>
                    <li>
                        Інтенсивність UV [0-355]: <span class="badge badge-violet" id="th-uv-intensity"></span>
                    </li>
                    <li>
                        Інтенсивність R [0-355]: <span class="badge badge-red" id="th-r-intensity"></span>
                    </li>
                    <li>
                        Інтенсивність G [0-355]: <span class="badge badge-green" id="th-g-intensity"></span>
                    </li>
                    <li>
                        Інтенсивність B [0-355]: <span class="badge badge-blue" id="th-b-intensity"></span>
                    </li>
                    <li>Колір встановленого освітлення:
                        <span class="light-color" id="th-color-light">&nbsp</span>
                    </li>



                </div>
            </div>
        </div>

    </div>


    {% if is_paginated %}
        <div class="container">
            <ul class="pagination pagination-sm">
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="sr-only">Previous</span>
                    </a>
                </li>

            {% else %}
                <li class="page-item disabled">
                    <a class="page-link" href="" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="sr-only">Previous</span>
                    </a>
                </li>
            {% endif %}

            {% for i in paginator.page_range %}
                {% if page_obj.number == i %}
                    <li class="page-item active">
                        <a class="page-link" href="">{{ i }} <span class="sr-only">(current)</span></a>
                    </li>

                {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>

                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                        <span class="sr-only">Next</span>
                    </a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <a class="page-link" href="" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                        <span class="sr-only">Next</span>
                    </a>
                </li>
            {% endif %}
            </ul>
        </div>
    {% endif %}
{% endblock %}

{% block script %}
    <script>
        set_filter_by_date({{ filter_by_date }})

        set_ts_name_state("{{ ts_state }}");
        set_ts_checked("{{ ts_state }}");

        set_current_state_name("{{ current_state }}");
        set_current_checked("{{ current_state }}");

        set_light_name_state("{{ light_state }}");
        set_light_checked("{{ light_state }}");

    </script>
    <script type="text/javascript">
        $(function () {
            $('#datetimepicker_to').datetimepicker({
                locale: 'ru',
                defaultDate: '{{ end_date|date:"Y-m-d H:i" }}',
                format: "DD / MM / YYYY  |  HH:mm",
            });
        });
    </script>

    <script type="text/javascript">
        $(function () {
            $('#datetimepicker_from').datetimepicker({
                locale: 'ru',
                defaultDate: '{{ start_date|date:"Y-m-d H:i" }}',
                format: "DD / MM / YYYY  |  HH:mm",
            });
        });
    </script>
{% endblock %}